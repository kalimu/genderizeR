<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Kamil Wais" />

<meta name="date" content="2019-03-11" />

<title>Introduction to genderizeR - tutorial</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Introduction to genderizeR - tutorial</h1>
<h4 class="author"><em>Kamil Wais</em></h4>
<h4 class="date"><em>2019-03-11</em></h4>



<p>R package for gender predictions based on first names by Kamil Wais.</p>
<p>The package homepage: <a href="https://kalimu.github.io/project/genderizer/" class="uri">https://kalimu.github.io/project/genderizer/</a>.</p>
<p>Information about the genderize.io project and documentation of the API: <a href="http://genderize.io" class="uri">http://genderize.io</a>.</p>
<div id="description" class="section level1">
<h1>Description</h1>
<p>The genderizeR package uses genderize.io API to <strong>predict gender</strong> from first names extracted from text corpuses (not only from clean vectors of given names). The accuracy of <strong>prediction could be controlled</strong> by two parameters: counts of first names in database and probability of gender given the first name. The package has also built-in functions that can <strong>calculate specific errors</strong> (also with bootstrapping), <strong>train algorithm</strong> on training dataset (with gender labels) and <strong>prepare character vectors for gender checking</strong> (text pre-processing).</p>
</div>
<div id="installing-the-package" class="section level1">
<h1>Installing the package</h1>
<div id="installing-stable-version-from-cran" class="section level2">
<h2>Installing stable version from CRAN</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">'genderizeR'</span>)</code></pre></div>
</div>
<div id="installing-developer-version-from-github" class="section level2">
<h2>Installing developer version from GitHub</h2>
<p>Remember to install <code>devtools</code> package first!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages('devtools')</span>
devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;kalimu/genderizeR&quot;</span>)</code></pre></div>
</div>
<div id="loading-the-installed-package" class="section level2">
<h2>Loading the installed package</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(genderizeR)</code></pre></div>
</div>
<div id="whats-new-in-the-package" class="section level2">
<h2>What’s new in the package?</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">news</span>(<span class="dt">package =</span> <span class="st">'genderizeR'</span>)</code></pre></div>
</div>
<div id="see-package-help-pages-in-r-rstudio" class="section level2">
<h2>See package help pages in R / RStudio</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">help</span>(<span class="dt">package =</span> <span class="st">'genderizeR'</span>)
?textPrepare
?findGivenNames
?genderize</code></pre></div>
</div>
</div>
<div id="a-simple-example" class="section level1">
<h1>A simple example</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># An example of a character vector of strings</span>
x =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Winston J. Durant, ASHP past president, dies at 84&quot;</span>,
<span class="st">&quot;JAN BASZKIEWICZ (3 JANUARY 1930 - 27 JANUARY 2011) IN MEMORIAM&quot;</span>,
<span class="st">&quot;Maria Sklodowska-Curie&quot;</span>)
 
<span class="co"># Search for terms that could be first names.</span>
<span class="co"># If you have your API key you can authorize access to the API with apikey argument</span>
<span class="co"># e.g. findGivenNames(x, progress = FALSE, apikey = 'your_api_key').</span>
givenNames =<span class="st"> </span><span class="kw">findGivenNames</span>(x, <span class="dt">progress =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># We can use only terms that have more than x counts in the database </span>
<span class="co"># to eliminate noise in gender data.</span>
givenNames =<span class="st"> </span>givenNames[count <span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span>]
givenNames</code></pre></div>
<pre><code>##       name gender probability count
## 1: winston   male        0.98   128
## 2:     jan   male         0.6  1663
## 3:   maria female        0.99  8402</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Genderize the original character vector.</span>
<span class="kw">genderize</span>(x, <span class="dt">genderDB =</span> givenNames, <span class="dt">progress =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>##                                                              text
## 1:             Winston J. Durant, ASHP past president, dies at 84
## 2: JAN BASZKIEWICZ (3 JANUARY 1930 - 27 JANUARY 2011) IN MEMORIAM
## 3:                                         Maria Sklodowska-Curie
##    givenName gender genderIndicators
## 1:   winston   male                1
## 2:       jan   male                1
## 3:     maria female                1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># We have got it right!</span></code></pre></div>
</div>
<div id="prepare-text-for-gender-checking" class="section level1">
<h1>Prepare text for gender checking</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Let's work with some block of text with some given names inside</span>
x =<span class="st"> &quot;Tom did play hookey, and he had a very good time. He got back home </span>
<span class="st">     barely in season to help Jim, the small colored boy, saw next-day's wood </span>
<span class="st">     and split the kindlings before supper-at least he was there in time </span>
<span class="st">     to tell his adventures to Jim while Jim did three-fourths of the work. </span>
<span class="st">     Tom's younger brother (or rather half-brother) Sid was already through </span>
<span class="st">     with his part of the work (picking up chips), for he was a quiet boy, </span>
<span class="st">     and had no adventurous, trouble-some ways. While Tom was eating his</span>
<span class="st">     supper, and stealing sugar as opportunity offered, Aunt Polly asked </span>
<span class="st">     him questions that were full of guile, and very deep-for she wanted </span>
<span class="st">     to trap him into damaging revealments. Like many other simple-hearted</span>
<span class="st">     souls, it was her pet vanity to believe she was endowed with a talent </span>
<span class="st">     for dark and mysterious diplomacy, and she loved to contemplate her </span>
<span class="st">     most transparent devices as marvels of low cunning. </span>
<span class="st">     (from 'Tom Sawyer' by Mark Twain)&quot;</span>

<span class="co"># We could send it to the findGivenNames() function as it is, </span>
<span class="co"># but let's see what textPrepare() function does for us.</span>

(<span class="dt">xPrepared =</span> <span class="kw">textPrepare</span>(x))</code></pre></div>
<pre><code>##   [1] &quot;adventures&quot;  &quot;adventurous&quot; &quot;already&quot;     &quot;and&quot;         &quot;as&quot;         
##   [6] &quot;asked&quot;       &quot;at&quot;          &quot;aunt&quot;        &quot;back&quot;        &quot;barely&quot;     
##  [11] &quot;before&quot;      &quot;believe&quot;     &quot;boy&quot;         &quot;brother&quot;     &quot;by&quot;         
##  [16] &quot;chips&quot;       &quot;colored&quot;     &quot;contemplate&quot; &quot;cunning&quot;     &quot;damaging&quot;   
##  [21] &quot;dark&quot;        &quot;day&quot;         &quot;deep&quot;        &quot;devices&quot;     &quot;did&quot;        
##  [26] &quot;diplomacy&quot;   &quot;eating&quot;      &quot;endowed&quot;     &quot;for&quot;         &quot;fourths&quot;    
##  [31] &quot;from&quot;        &quot;full&quot;        &quot;good&quot;        &quot;got&quot;         &quot;guile&quot;      
##  [36] &quot;had&quot;         &quot;half&quot;        &quot;he&quot;          &quot;hearted&quot;     &quot;help&quot;       
##  [41] &quot;her&quot;         &quot;him&quot;         &quot;his&quot;         &quot;home&quot;        &quot;hookey&quot;     
##  [46] &quot;in&quot;          &quot;into&quot;        &quot;it&quot;          &quot;jim&quot;         &quot;kindlings&quot;  
##  [51] &quot;least&quot;       &quot;like&quot;        &quot;loved&quot;       &quot;low&quot;         &quot;many&quot;       
##  [56] &quot;mark&quot;        &quot;marvels&quot;     &quot;most&quot;        &quot;mysterious&quot;  &quot;next&quot;       
##  [61] &quot;no&quot;          &quot;of&quot;          &quot;offered&quot;     &quot;opportunity&quot; &quot;or&quot;         
##  [66] &quot;other&quot;       &quot;part&quot;        &quot;pet&quot;         &quot;picking&quot;     &quot;play&quot;       
##  [71] &quot;polly&quot;       &quot;questions&quot;   &quot;quiet&quot;       &quot;rather&quot;      &quot;revealments&quot;
##  [76] &quot;saw&quot;         &quot;sawyer&quot;      &quot;season&quot;      &quot;she&quot;         &quot;sid&quot;        
##  [81] &quot;simple&quot;      &quot;small&quot;       &quot;some&quot;        &quot;souls&quot;       &quot;split&quot;      
##  [86] &quot;stealing&quot;    &quot;sugar&quot;       &quot;supper&quot;      &quot;talent&quot;      &quot;tell&quot;       
##  [91] &quot;that&quot;        &quot;the&quot;         &quot;there&quot;       &quot;three&quot;       &quot;through&quot;    
##  [96] &quot;time&quot;        &quot;to&quot;          &quot;tom&quot;         &quot;transparent&quot; &quot;trap&quot;       
## [101] &quot;trouble&quot;     &quot;twain&quot;       &quot;up&quot;          &quot;vanity&quot;      &quot;very&quot;       
## [106] &quot;wanted&quot;      &quot;was&quot;         &quot;ways&quot;        &quot;were&quot;        &quot;while&quot;      
## [111] &quot;with&quot;        &quot;wood&quot;        &quot;work&quot;        &quot;younger&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># We got all unique terms (at least 2 characters long) which can be our </span>
<span class="co"># candidates for given names.</span>

<span class="co"># If we using free API plan, it will be better to apply a list of stopwords </span>
<span class="co"># to use fewer API requests. Let's use some simplified one and remove </span>
<span class="co"># some of terms.</span>
xPrepared =<span class="st"> </span>xPrepared[<span class="op">!</span>xPrepared <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;before&quot;</span>, <span class="st">&quot;from&quot;</span>, <span class="st">&quot;had&quot;</span>, <span class="st">&quot;her&quot;</span>, <span class="st">&quot;in&quot;</span>, 
<span class="st">&quot;no&quot;</span>, <span class="st">&quot;that&quot;</span>, <span class="st">&quot;with&quot;</span>, <span class="st">&quot;at&quot;</span>, <span class="st">&quot;him&quot;</span>, <span class="st">&quot;into&quot;</span>, <span class="st">&quot;of&quot;</span>, <span class="st">&quot;the&quot;</span>, <span class="st">&quot;to&quot;</span>, <span class="st">&quot;he&quot;</span>, <span class="st">&quot;his&quot;</span>, 
<span class="st">&quot;it&quot;</span>, <span class="st">&quot;up&quot;</span>, <span class="st">&quot;for&quot;</span>, <span class="st">&quot;got&quot;</span>, <span class="st">&quot;as&quot;</span>, <span class="st">&quot;by&quot;</span>, <span class="st">&quot;did&quot;</span>, <span class="st">&quot;or&quot;</span>, <span class="st">&quot;was&quot;</span>, <span class="st">&quot;and&quot;</span>, <span class="st">&quot;back&quot;</span>, <span class="st">&quot;she&quot;</span>)]

<span class="co"># Now we are ready to look for terms that will be our candidates for given names.</span></code></pre></div>
</div>
<div id="finding-given-names" class="section level1">
<h1>Finding given names</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Use the findGivenNames() function to connect with the API.</span>

(<span class="dt">givenNames =</span> <span class="kw">findGivenNames</span>(xPrepared, <span class="dt">progress =</span> <span class="ot">FALSE</span>))</code></pre></div>
<pre><code>##        name gender probability count
##  1:    aunt female           1     6
##  2: believe female           1     1
##  3:     boy   male        0.98    40
##  4:   chips female           1     1
##  5:    dark   male        0.82    39
##  6:     day female        0.52    71
##  7:    deep   male        0.82    78
##  8:    full   male        0.67     3
##  9:    good   male        0.79    14
## 10:   guile   male           1     3
## 11:    half female           1     2
## 12:    home female         0.5     6
## 13:     jim   male           1  2291
## 14:    like   male         0.6     5
## 15:     low   male        0.73    67
## 16:    many   male           1     2
## 17:    mark   male           1  6176
## 18:    next   male           1     1
## 19:     pet female           1     1
## 20:    play   male           1     7
## 21:   polly female        0.99   191
## 22:     saw   male        0.75    12
## 23:  sawyer   male           1    14
## 24:  season female        0.78     9
## 25:     sid   male        0.92    71
## 26:   small female         0.6     5
## 27:   sugar female        0.71    17
## 28:  supper   male           1     2
## 29:    tell   male           1     2
## 30:   there female           1     6
## 31:    time   male           1     2
## 32:     tom   male           1  3736
## 33:    trap   male           1     2
## 34:  vanity female           1     2
## 35:    wood   male           1     3
##        name gender probability count</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># We have found more than thirty terms in the genderize.io database, but </span>
<span class="co"># many of them introduce only noise to gender data. We can remove them by setting </span>
<span class="co"># higher threshold of &quot;count&quot; parameter. By doing that we obtain more reliable results.</span>

givenNames[givenNames<span class="op">$</span>count <span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span>]</code></pre></div>
<pre><code>##     name gender probability count
## 1:   jim   male           1  2291
## 2:  mark   male           1  6176
## 3: polly female        0.99   191
## 4:   tom   male           1  3736</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Yes! We have got it right.</span></code></pre></div>
<div id="cashing-results-from-free-api-plan" class="section level2">
<h2>Cashing results from free API plan</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># If you work with free API plan you are limited to 1000 gueries a day.</span>
<span class="co"># If your vector of terms to check is quite large we may want to</span>
<span class="co"># somehow cache the results when you reach the limit and start from</span>
<span class="co"># that point the next day.</span>

<span class="co"># When you reached the limit you will get a message...</span>
givenNames_part1 =<span class="st"> </span><span class="kw">findGivenNames</span>(xPrepared)

<span class="co"># Terms checked: 10/86. First names found: 4.          |   0%</span>
<span class="co"># Terms checked: 20/86. First names found: 7.          |  11%</span>
<span class="co"># Terms checked: 30/86. First names found: 12.         |  22%</span>
<span class="co"># Terms checked: 40/86. First names found: 17.         |  33%</span>
<span class="co"># Terms checked: 50/86. First names found: 22.         |  44%</span>
<span class="co"># Terms checked: 60/86. First names found: 25.         |  56%</span>
<span class="co">#   |=================================                 |  67%</span>
<span class="co">#  Client error: (429) Too Many Requests (RFC 6585)</span>
<span class="co">#  Request limit reached</span>
<span class="co"># </span>
<span class="co"># The API queries stopped at 57 term. </span>
<span class="co"># If you have reached the end of your API limit, you can start the function again from that term and continue finding given names next time with efficient use of the API.</span>
<span class="co">#  Remember to add the results to already found names and not to overwrite them. </span>
<span class="co"># </span>
<span class="co"># Warning messages:</span>
<span class="co"># 1: In genderizeAPI(termsQuery, apikey = apikey, ssl.verifypeer = ssl.verifypeer) :</span>
<span class="co">#   You have used all available requests in this subscription plan.</span>
<span class="co"># 2: In findGivenNames(xPrepared) : The API queries stopped.</span>

<span class="co"># You can see that the query stopped at 57 term in this case.</span>
<span class="co"># We can use it tomorrow:</span>
givenNames_part2 =<span class="st"> </span><span class="kw">findGivenNames</span>(xPrepared[<span class="dv">57</span><span class="op">:</span><span class="kw">NROW</span>(xPrepared)])

<span class="co"># Finally, we can bind all parts together.</span>
givenNames =<span class="st"> </span><span class="kw">rbind</span>(givenNames_part1, givenNames_part2)</code></pre></div>
</div>
<div id="encoding-handling" class="section level2">
<h2>Encoding handling</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Genderize.io API uses UTF-8 encoding. We can also set specific locale.</span>
<span class="kw">Sys.setlocale</span>(<span class="st">&quot;LC_ALL&quot;</span>, <span class="st">&quot;Polish&quot;</span>)
(<span class="dt">x =</span> <span class="st">&quot;Róża&quot;)</span>
<span class="st"># [1] &quot;</span>Róża&quot;
(<span class="dt">xp =</span> <span class="kw">textPrepare</span>(x))
<span class="co"># [1] &quot;róża&quot;</span>
<span class="kw">findGivenNames</span>(x, <span class="dt">progress =</span> <span class="ot">FALSE</span>)
<span class="co">#    name gender probability count</span>
<span class="co"># 1: róża female        0.89    28</span></code></pre></div>
</div>
<div id="case-studies-in-genderizing" class="section level2">
<h2>Case studies in genderizing</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Let's say we have a character string with a first name within.</span>
x =<span class="st"> 'Pascual-Leone Pascual, Ana Ma'</span>
    
<span class="co"># There are four unique terms that will be checked in the API database.</span>
<span class="kw">textPrepare</span>(x)
<span class="co"># [1] &quot;ana&quot;     &quot;leone&quot;   &quot;ma&quot;      &quot;pascual&quot;</span>

<span class="co"># Let's don't assume which term is a given name and run through the API</span>
<span class="co"># all four terms.</span>
(<span class="dt">genderDB =</span> <span class="kw">findGivenNames</span>(x, <span class="dt">progress =</span> <span class="ot">FALSE</span>))
<span class="co">#       name gender probability count</span>
<span class="co"># 1:     ana female        0.99  3621</span>
<span class="co"># 2:   leone female        0.81    27</span>
<span class="co"># 3:      ma female        0.62   251</span>
<span class="co"># 4: pascual   male        1.00    26</span>
    
<span class="co"># Having data table with gender data, we can try to &quot;genderize&quot; the whole string.</span>
<span class="kw">genderize</span>(x, <span class="dt">genderDB =</span> genderDB, <span class="dt">progress =</span> <span class="ot">FALSE</span>) 
<span class="co">#                             text givenName gender genderIndicators</span>
<span class="co"># 1: Pascual-Leone Pascual, Ana Ma       ana female                4</span>

<span class="co"># The output shows that we used 4 terms as gender indicators and the algorithm</span>
<span class="co"># used most common term &quot;ana&quot; as final indicator of gender.</span>

<span class="co"># What about double first names like &quot;Hans-Peter&quot;?</span>
x =<span class="st"> 'Hans-Peter'</span>

(<span class="dt">genderDB =</span> <span class="kw">findGivenNames</span>(x, <span class="dt">progress =</span> <span class="ot">FALSE</span>))
<span class="co">#     name gender probability count</span>
<span class="co"># 1:  hans   male        0.99   431</span>
<span class="co"># 2: peter   male        1.00  4373</span>
<span class="kw">genderize</span>(x, <span class="dt">genderDB =</span> genderDB, <span class="dt">progress =</span> <span class="ot">FALSE</span>) 
<span class="co">#          text givenName gender genderIndicators</span>
<span class="co"># 1: Hans-Peter     peter   male                2</span>

<span class="co"># The classification algorithm predict &quot;Hans-Peter&quot; as male using the most</span>
<span class="co"># common first name of the two.    </span>

<span class="co"># Localization</span>

<span class="kw">findGivenNames</span>(<span class="st">&quot;andrea&quot;</span>, <span class="dt">country =</span> <span class="st">&quot;us&quot;</span>)
<span class="co">#      name gender probability count</span>
<span class="co"># 1: andrea female        0.97  2308</span>

<span class="kw">findGivenNames</span>(<span class="st">&quot;andrea&quot;</span>, <span class="dt">country =</span> <span class="st">&quot;it&quot;</span>)
<span class="co">#      name gender probability count</span>
<span class="co"># 1: andrea  male         0.99  1070</span>

<span class="kw">findGivenNames</span>(<span class="st">&quot;andrea&quot;</span>, <span class="dt">language =</span> <span class="st">&quot;en&quot;</span>)
<span class="co">#      name gender probability count</span>
<span class="co"># 1: andrea female        0.96  2562</span>

<span class="kw">findGivenNames</span>(<span class="st">&quot;andrea&quot;</span>, <span class="dt">language =</span> <span class="st">&quot;it&quot;</span>)
<span class="co">#      name gender probability count</span>
<span class="co"># 1: andrea   male        0.99  1070</span></code></pre></div>
</div>
</div>
<div id="calculating-gender-prediction-errors" class="section level1">
<h1>Calculating gender prediction errors</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Let's calculate now some metrics of gender prediction efficiency</span>
<span class="co"># on an exemplary random sample.</span>

<span class="kw">set.seed</span>(<span class="dv">238</span>)
labels =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">'male'</span>, <span class="st">'female'</span>, <span class="st">'unknown'</span>), <span class="dt">size =</span> <span class="dv">100</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
predictions =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">'male'</span>, <span class="st">'female'</span>, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="dv">100</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
    
indicators =<span class="st"> </span><span class="kw">classificationErrors</span>(labels, predictions)
<span class="co"># Confusion matrix for the generated sample </span>
indicators[[<span class="st">'confMatrix'</span>]] 
<span class="co">#          predictions</span>
<span class="co"># labels    female male &lt;NA&gt;</span>
<span class="co">#   female      12   10    4</span>
<span class="co">#   male         7   10   12</span>
<span class="co">#   unknown     16   13   16</span>
<span class="co">#   &lt;NA&gt;         0    0    0</span>
  
<span class="co"># The &quot;errorCoded&quot; is total classification error that takes into account</span>
<span class="co"># observations with known gender labels (&quot;female&quot; and &quot;male&quot;)</span>
<span class="co"># which cannot be automatically classified (&quot;NA&quot;).</span>
<span class="co"># errorCoded = (7 + 10 + 4 + 12) / (12 + 10 + 4 + 7 + 10 + 12)</span>
<span class="kw">unlist</span>(indicators[<span class="st">'errorCoded'</span>])
<span class="co"># errorCoded </span>
<span class="co">#        0.6    </span>

<span class="co"># The &quot;errorCodedWithoutNA&quot; takes into account only those observations</span>
<span class="co"># in which gender prediction was possible.</span>
<span class="co"># errorCodedWithoutNA = (7 + 10) / ( 12 + 10 + 7 + 10)</span>
<span class="kw">unlist</span>(indicators[<span class="st">'errorCodedWithoutNA'</span>])
<span class="co"># errorCodedWithoutNA </span>
<span class="co">#           0.4358974   </span>
    
<span class="co"># The &quot;naCoded&quot; is the proportion of observations without gender predictions.</span>
<span class="co"># It doesn't take into account predictions for labels &quot;unknown&quot;; </span>
<span class="co"># If a human coder couldn't classified such observation we shouldn't</span>
<span class="co"># penalize our algorithm for trying. </span>
<span class="co"># naCoded = (4 + 12) / ( 12 + 10 + 4 + 7 + 10 + 12)</span>
<span class="kw">unlist</span>(indicators[<span class="st">'naCoded'</span>])
<span class="co">#   naCoded </span>
<span class="co"># 0.2909091     </span>

<span class="co"># The &quot;errorGenderBias&quot; is robust for situations when we misclassify </span>
<span class="co"># the same number of female as male and male as female. </span>
<span class="co"># If it is close to zero we can assume that misclassified observations</span>
<span class="co"># won't affect much our estimates of true gender proportions.</span>
<span class="co"># errorGenderBias = (7 - 10) / (12 + 10 + 7 + 10)</span>
<span class="kw">unlist</span>(indicators[<span class="st">'errorGenderBias'</span>])
<span class="co"># errorGenderBias </span>
<span class="co">#     -0.07692308 </span></code></pre></div>
</div>
<div id="training-algorithm" class="section level1">
<h1>Training algorithm</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Let's look for optimal set of parameters for gender prediction</span>
<span class="co"># suitable for genderizing &quot;authorship&quot; dataset in the package.</span>
<span class="kw">data</span>(authorships)
<span class="kw">head</span>(authorships[, <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">5</span>)],<span class="dv">15</span>)
<span class="co">#              value genderCoded</span>
<span class="co"># 2636  Morison, Ian        male</span>
<span class="co"># 2637 Hughes, David        male</span>
<span class="co"># 2638 Higson, Roger        male</span>
<span class="co"># 2639    CONDON, HA      noname</span>
<span class="co"># 2640  GILCHRIST, E      noname</span>
<span class="co"># 2641     Haury, LR      noname    </span>

<span class="co"># In the genderizeR package we have prepared gender data for that set as well.</span>
<span class="kw">tail</span>(givenNamesDB_authorships)
<span class="co">#      name gender probability count</span>
<span class="co"># 1:     yv   male        1.00     1</span>
<span class="co"># 2:   yves   male        0.98   153</span>
<span class="co"># 3: zdenek   male        1.00    30</span>
<span class="co"># 4:  zhang   male        0.60    30</span>
<span class="co"># 5:    zhu   male        0.67     6</span>
<span class="co"># 6:     zy female        0.50     2</span>

<span class="co"># We can define values for probabilities and counts that will be used</span>
<span class="co"># for building the grid of possible combinations of these parameters.</span>
probs =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.97</span>, <span class="fl">0.98</span>, <span class="fl">0.99</span>, <span class="dv">1</span>)
counts =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>)

x =<span class="st"> </span>authorships<span class="op">$</span>value
y =<span class="st"> </span>authorships<span class="op">$</span>genderCoded

authorshipsGrid =
<span class="st">    </span><span class="kw">genderizeTrain</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y,
                   <span class="dt">givenNamesDB =</span> givenNamesDB_authorships,
                   <span class="dt">probs =</span> probs, <span class="dt">counts =</span> counts, 
                   <span class="dt">parallel =</span> <span class="ot">TRUE</span>)
    
authorshipsGrid
<span class="co">#     prob count errorCoded errorCodedWithoutNA    naCoded errorGenderBias</span>
<span class="co">#  1: 0.50     1 0.07093822          0.03791469 0.03432494     0.014218009</span>
<span class="co">#  2: 0.70     1 0.08466819          0.03147700 0.05491991     0.007263923</span>
<span class="co">#  3: 0.80     1 0.10983982          0.03233831 0.08009153     0.012437811</span>
<span class="co">#  4: 0.90     1 0.11899314          0.03022670 0.09153318     0.015113350</span>
<span class="co">#  5: 0.95     1 0.13272311          0.02820513 0.10755149     0.012820513</span>
<span class="co">#  6: 0.97     1 0.14645309          0.02610966 0.12356979     0.010443864</span>
<span class="co">#  7: 0.98     1 0.15560641          0.02638522 0.13272311     0.010554090</span>
<span class="co">#  8: 0.99     1 0.18306636          0.02724796 0.16018307     0.005449591</span>
<span class="co">#  9: 1.00     1 0.27459954          0.03353659 0.24942792    -0.003048780</span>
<span class="co"># 10: 0.50    10 0.12128146          0.03759398 0.08695652     0.017543860</span>
<span class="co"># 11: 0.70    10 0.13958810          0.02842377 0.11441648     0.007751938</span>
<span class="co"># 12: 0.80    10 0.16247140          0.02917772 0.13729977     0.013262599</span>
<span class="co"># 13: 0.90    10 0.16933638          0.02680965 0.14645309     0.016085791</span>
<span class="co"># 14: 0.95    10 0.18535469          0.02465753 0.16475973     0.013698630</span>
<span class="co"># 15: 0.97    10 0.19908467          0.02234637 0.18077803     0.011173184</span>
<span class="co"># 16: 0.98    10 0.20823799          0.02259887 0.18993135     0.011299435</span>
<span class="co"># 17: 0.99    10 0.23569794          0.02339181 0.21739130     0.005847953</span>
<span class="co"># 18: 1.00    10 0.33180778          0.02666667 0.31350114     0.000000000</span>
<span class="co"># 19: 0.50   100 0.27459954          0.03058104 0.25171625     0.012232416</span>
<span class="co"># 20: 0.70   100 0.29061785          0.02821317 0.27002288     0.009404389</span>
<span class="co"># 21: 0.80   100 0.30892449          0.02893891 0.28832952     0.016077170</span>
<span class="co"># 22: 0.90   100 0.31350114          0.02912621 0.29290618     0.016181230</span>
<span class="co"># 23: 0.95   100 0.32036613          0.02941176 0.29977117     0.016339869</span>
<span class="co"># 24: 0.97   100 0.32951945          0.02657807 0.31121281     0.013289037</span>
<span class="co"># 25: 0.98   100 0.33638444          0.02684564 0.31807780     0.013422819</span>
<span class="co"># 26: 0.99   100 0.36613272          0.02807018 0.34782609     0.007017544</span>
<span class="co"># 27: 1.00   100 0.45995423          0.02880658 0.44393593     0.004115226</span>
<span class="co">#     prob count errorCoded errorCodedWithoutNA    naCoded errorGenderBias</span>
  

<span class="co"># If we want to minimize &quot;errorCoded&quot; choosing standard prob=0.5 and count=1</span>
<span class="co"># gives us the smallest possible value.</span>
authorshipsGrid[authorshipsGrid<span class="op">$</span>errorCoded <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(authorshipsGrid<span class="op">$</span>errorCoded),]

<span class="co">#     prob count errorCoded errorCodedWithoutNA   naCoded errorGenderBias</span>
<span class="co"># 1:  0.5     1 0.07093822          0.03791469 0.03432494      0.01421801</span>

<span class="co"># However, if we would like to minimize &quot;errorCodedWithoutNA&quot; we should</span>
<span class="co"># choose prob = 0.97 and count = 10. The trade off is that the proportion </span>
<span class="co"># of observation with unpredicted gender (&quot;naCodded&quot;) will greatly increase. </span>
<span class="co"># authorshipsGrid[authorshipsGrid$errorCodedWithoutNA == </span>
                        <span class="kw">min</span>(<span class="kw">abs</span>(authorshipsGrid<span class="op">$</span>errorCodedWithoutNA)),]
    
<span class="co">#    prob count errorCoded errorCodedWithoutNA  naCoded errorGenderBias</span>
<span class="co"># 1: 0.97    10  0.1990847          0.02234637 0.180778      0.01117318</span></code></pre></div>
</div>
<div id="how-to-contribute-to-the-package" class="section level1">
<h1>How to contribute to the package?</h1>
<div id="for-bugs-updates-and-new-functionalities" class="section level2">
<h2>For bugs, updates and new functionalities:</h2>
<p>Fork git repo <a href="https://github.com/kalimu/genderizeR" class="uri">https://github.com/kalimu/genderizeR</a> and submit a pull request.</p>
</div>
<div id="feedback" class="section level2">
<h2>Feedback:</h2>
<p>If you enjoy using the package you could write a short testimonial and send it to me. I will be happy to post in on the package homepage.</p>
<p>For any kind of feedback you can use the contact form here: <a href="https://kalimu.github.io/#contact" class="uri">https://kalimu.github.io/#contact</a></p>
</div>
<div id="how-to-contact-the-author-regarding-research-or-commercial-project" class="section level2">
<h2>How to contact the author regarding research or commercial project?</h2>
<p>Please use the contact form: <a href="https://kalimu.github.io/#contact" class="uri">https://kalimu.github.io/#contact</a></p>
</div>
<div id="how-to-cite-the-package" class="section level2">
<h2>How to cite the package?</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">citation</span>(<span class="st">'genderizeR'</span>)</code></pre></div>
<pre><code>## 
## Wais K (2006). &quot;Gender Prediction Methods Based on First Names
## with genderizeR.&quot; _The R Journal_, *8*(1), 17-37. doi:
## 10.32614/RJ-2016-002 (URL: http://doi.org/10.32614/RJ-2016-002),
## &lt;URL: https://doi.org/10.32614/RJ-2016-002&gt;.
## 
## A BibTeX entry for LaTeX users is
## 
##   @Article{,
##     title = {{Gender Prediction Methods Based on First Names with
##           genderizeR}},
##     author = {Kamil Wais},
##     year = {2006},
##     journal = {{The R Journal}},
##     doi = {10.32614/RJ-2016-002},
##     pages = {17--37},
##     volume = {8},
##     number = {1},
##     url = {https://doi.org/10.32614/RJ-2016-002},
##   }</code></pre>
<p>Thank You for the citation!</p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
